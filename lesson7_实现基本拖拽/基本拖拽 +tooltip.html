<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>实现基本拖拽, 增加了tooltip组件</title>

    <script src="../js/echarts.min.js"></script>
    <script src="../js/jquery.min.js"></script>

</head>

<body>
    <div id="main" style="height:400px; width:600px;"></div>
    <script>
        mychart = echarts.init(document.getElementById("main"))

        // 设置图像大小
        var symbolSize = 20
        // 声明数据
        var data = [[15, 0], [-50, 10], [-56.5, 20], [-46.5, 30], [-22.1, 40]];
        option = {
            // 首先现在option中设置tooltiop
            tooltip: {
                // 表示不使用默认的『显示』『隐藏』触发规则。
                triggerOn: 'none',
                formatter: function (params) {
                    return 'X: ' + params.data[0].toFixed(2) + '<br>Y: ' + params.data[1].toFixed(2);
                }
            },
            xAxis: {
                min: -100,
                max: 80,
                type: 'value',
                axisLine: { onZero: false }
            },
            yAxis: {
                min: -30,
                max: 60,
                type: 'value',
                // 设置坐标轴线
                axisLine: {
                    // x轴或者y轴是否在另一条轴线的零点处
                    onZero: false
                }
            },
            series: [{
                id: 'a',
                type: 'line',
                smooth: true,
                symbolSize: symbolSize,
                data: data
            }]
        }
        mychart.setOption(option);

        mychart.setOption({
            // 设置拖拽
            // 声明graphic元素，使用map的方法遍历data的每项，为每项生成一个圆点
            graphic: echarts.util.map(data, function (dataItem, dataIndex) {
                return {
                    // circle这个表示graphic的类型为圆点
                    type: 'circle',
                    shape: {
                        // 圆点的半径
                        r: symbolSize / 2,
                    },
                    // 使用transform的方式对圆点进行定位，position：[x,y]表示将圆点平移到[x,y]的位置
                    position: mychart.convertToPixel('grid', dataItem),
                    // 这个属性使得圆点不可见，但是不影响鼠标事件
                    invisible: true,
                    // 使得圆点可以被拖拽
                    draggable: true,
                    // 使得z值设的比较大，表示这个圆点在最上方
                    z: 100,
                    // 圆点拖拽的响应事件将会不断的被触发
                    ondrag: echarts.util.curry(onPointDragging, dataIndex),

                    // 设置在onmousemover时显示tooltip,在onmouseout时隐藏
                    onmousemove: echarts.util.curry(showToolTip, dataIndex),
                    onmouseout: echarts.util.curry(hideToolTip, dataIndex)

                };
            })
        });

        // 拖拽某个圆点的过程会不断的调用这个函数，此函数会根据拖拽后的新位置，
        // 改变data的值。并会用新的data值重新绘制折线图，从而使得折线图同步于被拖拽的隐形的圆点
        function onPointDragging(dataIndex) {
            // 这里的data就是文本最初的代码块声明的data，在这里会被更新
            // 这里的this就是被拖拽的圆点，this.position就是圆点当前的位置
            data[dataIndex] = mychart.convertFromPixel('grid', this.position);
            // 重新绘制折线图
            mychart.setOption({
                series: [{
                    id: 'a',
                    data: data
                }]
            });
        }

        // 为了使得dom尺寸的改变时，图中的元素能够自适应的变化，需要加入以下部分
        window.addEventListener('resize', function () {
            // 对应每次拖拽圆点进行重新计算位置，并用setPosition进行更新
            mychart.setOption({
                graphic: echarts.util.map(data, function (item, dataIndex) {
                    return {
                        position: mychart.convertToPixel('grid', item)
                    };
                })
            });
        })

        // 显示tooltip
        function showToolTip(dataIndex) {
            mychart.dispatchAction({
                type: 'showTip',
                seriesIndex: 0,
                dataIndex: dataIndex
            })
        }
        // 隐藏tooltip
        function hideToolTip(dataIndex) {
            mychart.dispatchAction({
                type: 'hideTip'
            })
        }
    </script>
</body>

</html>